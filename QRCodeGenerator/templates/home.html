{% extends "base.html" %}

{% block active_home %}class="active"{% endblock active_home %}
{% block title %}Crie seu QR Code!{% endblock title %}

{% block content %}
<div class="wrapper container">
	<div class="row">
		<div class="col-md-2">
		</div>

		<div class="col-md-8">
			<h1 class="create-qr-code">Crie o seu QR Code!</h1>
			
			<div class="main-div">
				<p class="field-title">Título:</p>
				{{ form.title }}

				<p class="field-title">Descrição:</p>
				{{ form.description }}

				<p class="field-title">Mensagem:</p>
				{{ form.message_to_qr }}

				<p class="field-title">Tags (separadas por vírgula):</p>
				{{ form.tags }}
				<br>

				<button id="createBtn">Criar!</button>
			</div>
		</div>

		<div class="col-md-2">
		</div>
	</div>
</div>

<script type="text/javascript">
$("#createBtn").click(function() {
	var title = $("#{{ form.title.auto_id }}").val();
	var description = $("#{{ form.description.auto_id }}").val();
	var message_to_qr = $("#{{ form.message_to_qr.auto_id }}").val();
	var tags = $("#{{ form.tags.auto_id }}").val().replace(/ /g, '');

	if(tags.length != 0) {
		var sep_tags = tags.split(",");
	}
	else {
		var sep_tags = null;
	}

	$.ajax({
		url: "/generate-qrcode/",
		type: "POST",
		data: {"csrfmiddlewaretoken": "{{ csrf_token }}",
			"title": title,
			"description": description,
			"message_to_qr": message_to_qr,
			"tags[]": sep_tags
		},
	}).done(function(response) {
		window.location.replace(response.qrcode_page_url);
	});

});
</script>
{% endblock content %}